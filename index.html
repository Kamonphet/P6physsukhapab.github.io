<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สุขศึกษา ป.6: การสร้างเสริมสุขภาพ</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Sarabun (for Thai text) and Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* กำหนดฟอนต์หลักเป็น Sarabun และใช้ Inter เป็นฟอนต์สำรองสำหรับตัวเลข/อังกฤษ */
        body {
            font-family: 'Sarabun', 'Inter', sans-serif;
            background-color: #f7fbfd; /* โทนฟ้าพาสเทลอ่อนมาก */
        }
        /* Style สำหรับการเปลี่ยนหน้าแบบ Fade (Animation) */
        .content-page {
            transition: opacity 0.4s ease-in-out;
            opacity: 0;
            display: none;
        }
        .content-page.active {
            opacity: 1;
            display: block;
        }
        .nav-tab.active {
            background-color: #fce7f3; /* ชมพูอ่อนพาสเทล */
            color: #db2777; /* ชมพูเข้ม */
            border-bottom: 3px solid #db2777;
        }
        .card-shadow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.03);
        }
        /* Custom scrollbar for better look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #a5b4fc; /* Lavender */
            border-radius: 10px;
        }

        /* Adjust content height for less scrolling */
        .compact-grid {
            grid-template-columns: 1fr;
        }
        @media (min-width: 768px) {
            .compact-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pastel-blue': '#bfdbfe',
                        'pastel-pink': '#fbcfe8',
                        'pastel-mint': '#a7f3d0',
                        'pastel-bg': '#f7fbfd',
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header and Navigation Bar -->
    <header class="bg-white card-shadow sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <h1 class="text-xl font-bold text-teal-600">สุขศึกษา ป.6: การสร้างเสริมสุขภาพ</h1>
            </div>
        </div>
        
        <!-- Tabs -->
        <nav class="bg-gray-50 border-t border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-2 sm:space-x-4 text-sm sm:text-base font-medium">
                    <button class="nav-tab py-3 px-2 sm:px-4 text-gray-600 hover:text-teal-600 transition duration-300" data-page="page1" onclick="changePage('page1')">
                        บทที่ 1: สุขภาพกับสิ่งแวดล้อม
                    </button>
                    <button class="nav-tab py-3 px-2 sm:px-4 text-gray-600 hover:text-teal-600 transition duration-300" data-page="page2" onclick="changePage('page2')">
                        บทที่ 2: โรคภัยป้องกันได้
                    </button>
                    <button class="nav-tab py-3 px-2 sm:px-4 text-gray-600 hover:text-teal-600 transition duration-300" data-page="page4" onclick="changePage('page4')">
                        เกมผู้พิชิตโรคภัย
                    </button>
                    <button class="nav-tab py-3 px-2 sm:px-4 text-gray-600 hover:text-teal-600 transition duration-300" data-page="page5" onclick="changePage('page5')">
                        แบบทดสอบท้ายบท
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- บทที่ 1 สุขภาพกับสิ่งแวดล้อม-->
        <div id="page1" class="content-page active">
            <h2 class="text-3xl font-extrabold text-teal-700 mb-6 border-b-2 border-teal-300 pb-2">บทที่ 1: สุขภาพกับสิ่งแวดล้อม</h2>
            
            <!-- ปัญหาสิ่งแวดล้อม -->
            <section class="mb-8 p-6 bg-white rounded-xl card-shadow">
                <h3 class="text-2xl font-bold text-pink-600 mb-4">ปัญหาของสิ่งแวดล้อมที่มีผลต่อสุขภาพ</h3>
                <div class="space-y-6">

                    <div class="flex flex-col md:flex-row items-center bg-pink-50 p-4 rounded-lg">
                        <img src="https://img.freepik.com/premium-vector/water-pollution-vector-illustration_1151527-14709.jpg" alt="มลพิษทางน้ำ" class="rounded-lg mb-4 md:mb-0 md:mr-6 w-32 h-32 object-cover">
                        <div>
                            <p class="text-lg font-semibold text-pink-700">1. มลพิษทางน้ำ</p>
                            <p class="text-gray-700">คือน้ำที่มีสิ่งแปลกปลอม เช่น ขยะ สิ่งปฏิกูล และสารเคมีปนเปื้อน สาเหตุหลักคือการปล่อยน้ำทิ้งจากบ้านเรือนและโรงงานโดยไม่บำบัด</p>
                        </div>
                    </div>

                    <div class="flex flex-col md:flex-row items-center bg-teal-50 p-4 rounded-lg">
                        <img src="https://img.freepik.com/premium-vector/air-pollution-cartoon-vector-illustration-isolated_1120563-38575.jpg" alt="มลพิษทางอากาศ" class="rounded-lg mb-4 md:mb-0 md:mr-6 w-32 h-32 object-cover">
                        <div>
                            <p class="text-lg font-semibold text-teal-700">2. มลพิษทางอากาศ</p>
                            <p class="text-gray-700">คืออากาศที่มีสารพิษ เช่น ควันจากโรงงานอุตสาหกรรม, ควันจากท่อไอเสียรถยนต์, ฝุ่น PM 2.5</p>
                        </div>
                    </div>
                    
                    <div class="flex flex-col md:flex-row items-center bg-yellow-50 p-4 rounded-lg">
                        <img src="https://img.freepik.com/premium-vector/noise-pollution-vector-cartoon-illustration-environmental-issue-concept_1322206-49994.jpg" alt="มลพิษทางเสียง" class="rounded-lg mb-4 md:mb-0 md:mr-6 w-32 h-32 object-cover">
                        <div>
                            <p class="text-lg font-semibold text-yellow-700">3. มลพิษทางเสียง</p>
                            <p class="text-gray-700">คือเสียงที่ดังเกินขนาดมาตรฐาน เช่น เสียงจากเครื่องจักรกล หรือการจราจรที่หนาแน่น ทำให้เกิดความเครียดและหงุดหงิด</p>
                        </div>
                    </div>

                    <div class="flex flex-col md:flex-row items-center bg-indigo-50 p-4 rounded-lg">
                        <img src="https://img.freepik.com/premium-vector/illustration-trash-rubbish-garbage_909058-3642.jpg" alt="ขยะมูลฝอย" class="rounded-lg mb-4 md:mb-0 md:mr-6 w-32 h-32 object-cover">
                        <div>
                            <p class="text-lg font-semibold text-indigo-700">4. ขยะมูลฝอยและสิ่งปฏิกูล</p>
                            <p class="text-gray-700">ขยะที่ขาดการจัดการทำให้เกิดแหล่งเพาะพันธุ์เชื้อโรค, กลิ่นเหม็น, และกลายเป็นมลพิษอื่น ๆ (เช่น น้ำชะขยะ)</p>
                        </div>
                    </div>

                    <div class="flex flex-col md:flex-row items-center bg-green-50 p-4 rounded-lg">
                        <img src="https://media.istockphoto.com/id/1162146857/th/%E0%B9%80%E0%B8%A7%E0%B8%84%E0%B9%80%E0%B8%95%E0%B8%AD%E0%B8%A3%E0%B9%8C/%E0%B8%A0%E0%B8%B2%E0%B8%9E%E0%B8%9B%E0%B8%A3%E0%B8%B0%E0%B8%81%E0%B8%AD%E0%B8%9A%E0%B8%AB%E0%B8%A5%E0%B8%B8%E0%B8%A1%E0%B9%83%E0%B8%AB%E0%B8%8D%E0%B9%88%E0%B8%9E%E0%B8%B7%E0%B9%89%E0%B8%99%E0%B8%94%E0%B8%B4%E0%B8%99-%E0%B8%87%E0%B8%B2%E0%B8%99%E0%B8%9E%E0%B8%B7%E0%B9%89%E0%B8%99%E0%B8%94%E0%B8%B4%E0%B8%99%E0%B8%82%E0%B8%B8%E0%B8%94%E0%B8%AB%E0%B8%B4%E0%B8%99%E0%B9%80%E0%B8%AA%E0%B8%B5%E0%B8%A2%E0%B8%96%E0%B9%88%E0%B8%B2%E0%B8%99%E0%B8%AB%E0%B8%B4%E0%B8%99%E0%B8%97%E0%B8%A3%E0%B8%B2%E0%B8%A2%E0%B9%81%E0%B8%A5%E0%B8%B0%E0%B8%A0%E0%B8%B2%E0%B8%9E%E0%B8%9B%E0%B8%A3%E0%B8%B0%E0%B8%81%E0%B8%AD%E0%B8%9A%E0%B8%81%E0%B8%A3%E0%B8%A7%E0%B8%94.jpg?s=612x612&w=0&k=20&c=HNa64maz9McaBJVWlZDUiuYDMyuw_VNBFkHYCAtMKeI=" alt="ดินเสีย" class="rounded-lg mb-4 md:mb-0 md:mr-6 w-32 h-32 object-cover">
                        <div>
                            <p class="text-lg font-semibold text-green-700">5. ดินเสีย</p>
                            <p class="text-gray-700">ดินที่เสื่อมคุณภาพจากการใช้สารเคมีทางการเกษตรมากเกินไป ทำให้ไม่สามารถเพาะปลูกได้ และอาจมีสารพิษปนเปื้อนในพืช</p>
                        </div>
                    </div>

                </div>
            </section>

            <!-- ผลกระทบและการป้องกัน -->
            <section class="mb-8 p-6 bg-white rounded-xl card-shadow">
                <h3 class="text-2xl font-bold text-teal-600 mb-4">ผลกระทบและการป้องกัน</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- ผลกระทบ -->
                    <div class="bg-red-100 p-4 rounded-lg">
                        <h4 class="text-xl font-semibold text-red-700 mb-2">ผลกระทบต่อสุขภาพ</h4>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li>**ด้านร่างกาย:** เกิดโรคทางเดินหายใจ (จากอากาศ), โรคระบบทางเดินอาหาร (จากน้ำเสีย)</li>
                            <li>**ด้านจิตใจ:** ความเครียด, หงุดหงิด (จากมลพิษทางเสียง), และความวิตกกังวล</li>
                            <li>ร่างกายอ่อนแอ สุขภาพกายเสื่อมโทรมลง</li>
                        </ul>
                        <img src="https://img.freepik.com/premium-vector/illustrating-profound-impact-childhood-trauma-mental-health_1263357-41642.jpg" alt="ผลกระทบต่อสุขภาพ" class="mt-4 rounded-lg w-full">
                    </div>
                    <!-- การป้องกัน -->
                    <div class="bg-green-100 p-4 rounded-lg">
                        <h4 class="text-xl font-semibold text-green-700 mb-2">การป้องกันและแก้ไข</h4>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li>**ลดมลพิษทางอากาศ:** ใช้ยานพาหนะสาธารณะ และปลูกต้นไม้</li>
                            <li>**ลดมลพิษทางน้ำ:** ไม่ทิ้งขยะหรือน้ำเสียลงในแหล่งน้ำ</li>
                            <li>**จัดการขยะ:** ใช้หลัก 3R (Reduce, Reuse, Recycle) คัดแยกขยะ</li>
                            <li>**ลดมลพิษทางเสียง:** หลีกเลี่ยงการทำเสียงดังในที่สาธารณะ</li>
                        </ul>
                        <img src="https://img.freepik.com/premium-vector/vector-3r-reduce-reuse-recycle-sign-symbol_940471-1991.jpg" alt="การป้องกัน 3R" class="mt-4 rounded-lg w-30">
                    </div>
                </div>
            </section>
        </div>
        
        <!-- บทที่ 2 โรคภัยป้องกันได้ -->
        <div id="page2" class="content-page">
            <h2 class="text-3xl font-extrabold text-teal-700 mb-6 border-b-2 border-teal-300 pb-2">บทที่ 2: โรคภัยป้องกันได้</h2>
            
            <section class="mb-8 p-6 bg-white rounded-xl card-shadow">
                <h3 class="text-2xl font-bold text-pink-600 mb-4">ความหมายและตัวอย่างโรคติดต่อที่พบบ่อย</h3>
                <p class="text-gray-700 mb-6">**โรคติดต่อ** คือโรคที่เกิดจากเชื้อโรคที่สามารถแพร่จากคนหรือสัตว์สู่คนได้</p>
                
                <div id="disease-list" class="space-y-4">
                    <!-- Disease Card Template -->
                    
                </div>
            </section>
        </div>
        
        <!-- เกมผู้พิชิตโรคภัย -->
        <div id="page4" class="content-page">
            <h2 class="text-3xl font-extrabold text-teal-700 mb-6 border-b-2 border-teal-300 pb-2">หน้าที่ 4: กิจกรรม - เกมผู้พิชิตโรคภัย</h2>
            
            <div id="game-container" class="p-6 bg-white rounded-xl card-shadow text-center">
                <h3 class="text-2xl font-bold text-pink-600 mb-4">เกม: ผู้พิชิตโรคภัย (รวม 10 คำถาม)</h3>
                <p class="text-gray-600 mb-6">ทายอาการและวิธีการป้องกันให้ถูกต้อง เพื่อเป็นผู้พิชิตโรคภัย!</p>

                <div id="game-quiz" class="space-y-6">
                    <div id="game-image-box" class="w-full max-w-sm mx-auto p-4 bg-pastel-mint rounded-lg card-shadow">
                        <img id="game-image" src="" alt="ภาพอาการโรค" class="w-full h-48 object-cover rounded-md mb-4 border-4 border-white">
                        <p id="game-question" class="text-xl font-semibold text-teal-800">คำถาม</p>
                    </div>

                    <!-- Answer Options -->
                    <div id="game-options" class="grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-lg mx-auto">
                        <!-- Options will be injected here -->
                    </div>

                    <!-- Feedback Area -->
                    <div id="game-feedback" class="mt-6 p-4 rounded-lg font-medium hidden"></div>

                    <button id="next-game-btn" onclick="nextGameQuestion()" class="mt-4 bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-6 rounded-full transition duration-300 transform hover:scale-105 shadow-md">
                        คำถามถัดไป
                    </button>
                </div>
            </div>
        </div>
        
        <!-- แบบทดสอบท้ายบท -->
        <div id="page5" class="content-page">
            <h2 class="text-3xl font-extrabold text-teal-700 mb-6 border-b-2 border-teal-300 pb-2">หน้าที่ 5: แบบทดสอบท้ายบท (25 ข้อ)</h2>

            <!-- Student ID Randomizer -->
            <section class="mb-8 p-6 bg-yellow-100 rounded-xl card-shadow">
                <h3 class="text-2xl font-bold text-yellow-800 mb-4">ระบบสุ่มเลขที่นักเรียน</h3>
                <div class="flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <input type="number" id="min-id" value="1" placeholder="เลขที่เริ่มต้น" class="p-2 border border-yellow-300 rounded-lg w-full sm:w-1/5">
                    <span class="text-lg font-semibold text-yellow-800 hidden sm:block">ถึง</span>
                    <input type="number" id="max-id" value="40" placeholder="เลขที่สิ้นสุด" class="p-2 border border-yellow-300 rounded-lg w-full sm:w-1/5">
                    <button onclick="randomizeId()" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-6 rounded-full transition duration-300 shadow-md w-full sm:w-auto">
                        สุ่มเลขที่ของฉัน และเริ่มแบบทดสอบ
                    </button>
                    <p id="student-id-display" class="text-xl font-bold text-teal-700 bg-white p-2 rounded-lg border-2 border-yellow-500 w-full sm:w-1/5 text-center">
                        เลขที่: ?
                    </p>
                </div>
            </section>

            <!-- Quiz Questions Container -->
            <section id="quiz-container" class="p-6 bg-white rounded-xl card-shadow">
                <p id="quiz-instruction" class="text-gray-700 mb-6 font-medium">
                    **คำชี้แจง:** กรุณากด **"สุ่มเลขที่ของฉัน"** ด้านบนเพื่อเริ่มต้นทำแบบทดสอบ
                </p>
                
                <div id="quiz-question-display" class="hidden">
                    <!-- Current question will be displayed here -->
                    <div id="current-question-card" class="quiz-question-card p-4 rounded-lg border border-gray-100 shadow-md transition duration-300">
                        <p id="quiz-q-number" class="font-bold text-xl mb-3 text-teal-700">คำถามข้อที่ 1/25</p>
                        <p id="quiz-q-text" class="font-bold text-lg mb-4 text-gray-800"></p>
                        <div class="options space-y-2" id="current-quiz-options">
                            <!-- Options -->
                        </div>
                        <div id="current-quiz-feedback" class="mt-3 p-3 text-sm rounded-lg hidden"></div>
                    </div>

                    <div class="mt-6 flex justify-end">
                        <button id="next-quiz-btn" onclick="nextQuizQuestion()" class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-2 px-6 rounded-full transition duration-300 transform hover:scale-105 shadow-lg hidden" disabled>
                            คำถามถัดไป
                        </button>
                    </div>
                </div>

                <div class="mt-8 p-4 bg-teal-100 text-teal-800 rounded-lg text-center font-bold text-xl hidden" id="quiz-completion-message">
                    🎉 ทำแบบทดสอบครบ 25 ข้อแล้ว! ขอแสดงความยินดี
                    <p class="text-sm mt-2 text-teal-600 font-normal">คุณสามารถเปลี่ยนไปหน้าอื่น หรือสุ่มเลขที่ใหม่เพื่อเริ่มทำแบบทดสอบซ้ำได้</p>
                </div>
            </section>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-teal-700 mt-10 py-4">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-white text-sm">
            จัดทำโดย ครูเพชร | 2025
        </div>
    </footer>

    <script>
        // --- Global State and Data ---

        const diseaseData = [
            { name: "โรคอหิวาตกโรค", image: "https://static.thairath.co.th/media/Dtbezn3nNUxytg04aveW7z17HYImyKOOwts7IEu2FsWYWL.jpg", 
              info: "เกิดจากเชื้อแบคทีเรีย <br><b>สาเหตุ:</b> กินอาหาร/น้ำที่ไม่ปรุงสุก <br><b>อาการ:</b> ถ่ายเหลว/ถ่ายเป็นน้ำหลายครั้ง อาจเสียชีวิตได้เพราะขาดน้ำ <br><b>ป้องกัน:</b> กินอาหารปรุงสุกใหม่ ดื่มน้ำสะอาด ล้างมือ" },
            { name: "โรคไข้หวัดนก", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ_uG1DbyKG9h39joZObMDRuf7e1ckLFg1asA&s", 
              info: "เกิดจากเชื้อไวรัสในสัตว์ปีก <br><b>สาเหตุ:</b> สัมผัสโดยตรง/ทางอ้อมกับสิ่งคัดหลั่งจากสัตว์ที่เป็นโรค <br><b>อาการ:</b> ไข้สูง หนาวสั่น ปวดเมื่อยกล้ามเนื้อ <br><b>ป้องกัน:</b> กินอาหารที่ปรุงสุกเท่านั้น เลือกซื้อผลิตภัณฑ์ที่ได้มาตรฐาน ล้างมือหลังจับต้องเนื้อสัตว์" },
            { name: "โรคมือ เท้า ปาก", image: "https://www.ekachaihospital.com/th/wp-content/uploads/2015/07/mur-tao-pak.jpeg", 
              info: "เกิดจากเชื้อไวรัสลำไส้ พบมากในเด็กเล็ก <br><b>สาเหตุ:</b> ได้รับเชื้อเข้าปากโดยตรงจากมือ ของเล่น น้ำลายที่เปื้อนเชื้อ <br><b>อาการ:</b> ไข้ต่ำ เจ็บปาก มีตุ่มแดง/แผลหลุมตื้น ที่ฝ่ามือ ฝ่าเท้า และก้น <br><b>ป้องกัน:</b> ล้างมือบ่อย ๆ ใช้ช้อนกลาง หลีกเลี่ยงการใช้สิ่งของร่วมกับผู้อื่น" },
            { name: "โรคเอดส์ (AIDS)", image: "https://media.istockphoto.com/id/1183389302/th/%E0%B9%80%E0%B8%A7%E0%B8%84%E0%B9%80%E0%B8%95%E0%B8%AD%E0%B8%A3%E0%B9%8C/%E0%B8%9C%E0%B8%B9%E0%B9%89%E0%B8%AB%E0%B8%8D%E0%B8%B4%E0%B8%87%E0%B9%82%E0%B8%AD%E0%B8%9A%E0%B8%81%E0%B8%AD%E0%B8%94%E0%B8%95%E0%B8%B1%E0%B8%A7%E0%B9%80%E0%B8%AD%E0%B8%87%E0%B8%94%E0%B9%89%E0%B8%A7%E0%B8%A2%E0%B8%A3%E0%B8%B4%E0%B8%9A%E0%B8%9A%E0%B8%B4%E0%B9%89%E0%B8%99%E0%B8%AA%E0%B8%B5%E0%B9%81%E0%B8%94%E0%B8%87%E0%B9%80%E0%B8%9E%E0%B8%B7%E0%B9%88%E0%B8%AD%E0%B8%AA%E0%B8%99%E0%B8%B1%E0%B8%9A%E0%B8%AA%E0%B8%99%E0%B8%B8%E0%B8%99%E0%B8%9C%E0%B8%B9%E0%B9%89%E0%B8%9B%E0%B9%88%E0%B8%A7%E0%B8%A2%E0%B9%80%E0%B8%AD%E0%B8%94%E0%B8%AA%E0%B9%8C%E0%B9%81%E0%B8%A5%E0%B8%B0%E0%B9%80%E0%B8%AD%E0%B8%8A%E0%B9%84%E0%B8%AD%E0%B8%A7%E0%B8%B5.jpg?s=612x612&w=0&k=20&c=PhtA4U95Wys9NpGYEr37o5uJp4AQRimLZxY00Niw8lw=", 
              info: "เกิดจากเชื้อ HIV ทำลายเม็ดเลือดขาว <br><b>สาเหตุ:</b> การมีเพศสัมพันธ์ไม่ป้องกัน การรับเชื้อทางเลือด ถ่ายทอดจากแม่สู่ลูก <br><b>อาการ:</b> อ่อนเพลีย น้ำหนักลด มีไข้เป็นเดือน ต่อมน้ำเหลืองโต <br><b>ป้องกัน:</b> ใช้ถุงยางอนามัยทุกครั้ง ไม่ใช้เข็มฉีดยาร่วมกับผู้อื่น" },
            { name: "โรคโควิด-19", image: "https://gmhplanning.co.uk/wp-content/uploads/2022/01/covid-19-gc3571064d_1280.png", 
              info: "เกิดจากไวรัสโคโรนาสายพันธุ์ใหม่ <br><b>สาเหตุ:</b> ละอองฝอยจากการไอ/จาม สัมผัสพื้นผิวที่มีเชื้อ <br><b>อาการ:</b> ไข้ ไอแห้ง อ่อนเพลีย สูญเสียการรับรสหรือกลิ่น หายใจลำบาก <br><b>ป้องกัน:</b> สวมหน้ากาก ล้างมือบ่อย ๆ รักษาระยะห่าง ฉีดวัคซีน" },
            { name: "โรคไอกรน", image: "https://f.ptcdn.info/905/085/000/m2mwfgb5ikf1nmGYlj4-o.jpg", 
              info: "เกิดจากเชื้อแบคทีเรีย <br><b>สาเหตุ:</b> เชื้ออยู่ในลำคอส่วนจมูกของผู้ป่วย <br><b>อาการ:</b> ไอซ้อน ๆ ติดต่อกัน จนหายใจไม่ทัน ตามด้วยการหายใจเข้าลึก ๆ เป็น เสียงวูบ (Whooping cough) <br><b>ป้องกัน:</b> ฉีดวัคซีนป้องกันโรคไอกรนตามกำหนด" }
        ];

        const quizQuestions = [
            // 25 Questions
            { id: 1, text: "การกระทำใดที่ทำให้เกิดมลพิษทางน้ำโดยตรง?", options: ["ก. ปล่อยน้ำทิ้งจากครัวเรือนลงแม่น้ำ", "ข. สวมหน้ากากอนามัยขณะไอ", "ค. นำขยะมาเผาในที่โล่ง", "ง. ใช้สารเคมีในการเกษตร"], correct: 0, reason: "การปล่อยน้ำเสียลงแหล่งน้ำคือสาเหตุหลักของมลพิษทางน้ำ" },
            { id: 2, text: "ข้อใดคือผลกระทบด้านสุขภาพจากปัญหาสิ่งแวดล้อม?", options: ["ก. สังคมมีความสงบสุข", "ข. ร่างกายอ่อนแอ สุขภาพกายเสื่อมโทรม", "ค. มีค่าใช้จ่ายในการเดินทางเพิ่มขึ้น", "ง. แหล่งน้ำมีปลาชุกชุม"], correct: 1, reason: "ปัญหาสิ่งแวดล้อมทำให้สุขภาพกายเสื่อมโทรมและร่างกายอ่อนแอ" },
            { id: 3, text: "การนำขวดพลาสติกกลับมาใช้ซ้ำเป็นการแก้ไขปัญหาสิ่งแวดล้อมตามหลักใด?", options: ["ก. Reduce", "ข. Reuse", "ค. Recycle", "ง. Restore"], correct: 1, reason: "Reuse คือ การนำกลับมาใช้ซ้ำโดยยังไม่แปรรูป" },
            { id: 4, text: "ข้อใดคือสาเหตุหลักที่ทำให้ดินเสีย?", options: ["ก. การปลูกผักสวนครัว", "ข. การตัดต้นไม้", "ค. การใช้สารเคมีและปุ๋ยเคมีมากเกินไป", "ง. การสร้างบ้าน"], correct: 2, reason: "สารเคมีทำให้ดินเสื่อมคุณภาพ" },
            { id: 5, text: "ข้อใดคือการป้องกันและแก้ไขมลพิษทางเสียง?", options: ["ก. ปลูกต้นไม้เยอะๆ", "ข. บำบัดน้ำเสีย", "ค. หลีกเลี่ยงบริเวณที่มีเสียงดังเกินไป", "ง. งดการใช้พลาสติก"], correct: 2, reason: "การหลีกเลี่ยงช่วยลดผลกระทบจากมลพิษทางเสียง" },
            { id: 6, text: "โรคอหิวาตกโรคติดต่อเข้าสู่ร่างกายโดยวิธีใดเป็นหลัก?", options: ["ก. การกินอาหารที่ไม่ปรุงสุก หรือน้ำไม่สะอาด", "ข. การถูกยุงลายกัด", "ค. การสัมผัสละอองฝอยทางอากาศ", "ง. การมีเพศสัมพันธ์"], correct: 0, reason: "เชื้ออหิวาต์เข้าสู่ร่างกายผ่านการกินอาหารและน้ำที่ปนเปื้อน" },
            { id: 7, text: "หากมีอาการถ่ายเป็นน้ำวันละหลายครั้ง ควรสงสัยว่าเป็นโรคใด?", options: ["ก. โรคไข้หวัดนก", "ข. โรคมือ เท้า ปาก", "ค. โรคอหิวาตกโรค", "ง. โรคไอกรน"], correct: 2, reason: "อาการถ่ายเป็นน้ำรุนแรง เป็นอาการหลักของอหิวาตกโรค" },
            { id: 8, text: "การป้องกันโรคไข้หวัดนกที่ดีที่สุดคือข้อใด?", options: ["ก. รีบฉีดวัคซีนป้องกัน", "ข. รับประทานอาหารที่ปรุงสุกเท่านั้น", "ค. ล้างมือหลังสัมผัสปลา", "ง. หลีกเลี่ยงการใช้ส้วม"], correct: 1, reason: "การกินอาหารปรุงสุกช่วยป้องกันเชื้อจากสัตว์ปีก" },
            { id: 9, text: "โรคมือ เท้า ปาก มักพบตุ่มแดงหรือแผลหลุมตื้นที่บริเวณใดของร่างกาย?", options: ["ก. ลำคอและหน้าอก", "ข. ใบหน้าและหลัง", "ค. ฝ่ามือ ฝ่าเท้า และก้น", "ง. แขนและขาอ่อน"], correct: 2, reason: "เป็นลักษณะอาการเด่นของโรคมือ เท้า ปาก" },
            { id: 10, text: "เชื้อ HIV ส่งผลกระทบต่อระบบใดในร่างกายมากที่สุด?", options: ["ก. ระบบขับถ่าย", "ข. ระบบประสาทส่วนกลาง", "ค. ระบบภูมิคุ้มกัน", "ง. ระบบกล้ามเนื้อ"], correct: 2, reason: "เชื้อ HIV ทำลายเม็ดเลือดขาว ทำให้ภูมิคุ้มกันบกพร่อง" },
            { id: 11, text: "ข้อใดไม่ใช่ช่องทางการติดต่อของเชื้อ HIV?", options: ["ก. การมีเพศสัมพันธ์โดยไม่ใช้ถุงยางอนามัย", "ข. การใช้เข็มฉีดยาร่วมกัน", "ค. การกินอาหารร่วมกับผู้ป่วย", "ง. การถ่ายทอดจากแม่สู่ลูก"], correct: 2, reason: "HIV ไม่ติดต่อผ่านทางอาหารหรือการใช้ภาชนะร่วมกัน" },
            { id: 12, text: "อาการสำคัญของ COVID-19 ที่แตกต่างจากหวัดทั่วไปคือข้อใด?", options: ["ก. มีไข้ต่ำ", "ข. ไอแห้ง", "ค. สูญเสียการรับรสหรือกลิ่น", "ง. ปวดหัว"], correct: 2, reason: "การสูญเสียการรับรสหรือกลิ่นเป็นอาการจำเพาะที่เด่นชัด" },
            { id: 13, text: "การป้องกัน COVID-19 ที่มีประสิทธิภาพที่สุดวิธีหนึ่งคือข้อใด?", options: ["ก. ดื่มน้ำมะนาวทุกวัน", "ข. การกินยาปฏิชีวนะ", "ค. การฉีดวัคซีน", "ง. การกลั้นหายใจ"], correct: 2, reason: "การฉีดวัคซีนเป็นวิธีป้องกันหลักที่แนะนำ" },
            { id: 14, text: "อาการไอที่มีเสียงหายใจเข้าลึก ๆ เป็นเสียง 'วูบ' (Whooping cough) คืออาการของโรคใด?", options: ["ก. โรคไข้หวัดใหญ่", "ข. โรคเอดส์", "ค. โรคไอกรน", "ง. โรคหัด"], correct: 2, reason: "เสียงวูบเป็นลักษณะเฉพาะของโรคไอกรน" },
            { id: 15, text: "ข้อใดคือลักษณะของโรคติดต่อ?", options: ["ก. โรคที่เกิดจากเชื้อโรคและแพร่จากคนสู่คนได้", "ข. โรคที่เกิดจากพันธุกรรม", "ค. โรคที่เกิดจากอุบัติเหตุ", "ง. โรคที่รักษาไม่หายขาด"], correct: 0, reason: "ตามความหมายของโรคติดต่อที่เกิดจากเชื้อโรค" },
            { id: 16, text: "โรคใดที่แพทย์จะแนะนำให้ผู้ป่วยดื่มน้ำมาก ๆ เพื่อป้องกันการขาดน้ำ?", options: ["ก. โรคเอดส์", "ข. โรคอหิวาตกโรค", "ค. โรคไอกรน", "ง. โรคไข้หวัดนก"], correct: 1, reason: "การถ่ายเหลวรุนแรงทำให้เกิดภาวะขาดน้ำในอหิวาตกโรค" },
            { id: 17, text: "โรคเอดส์อยู่ในระยะใดที่ผู้ป่วยอาจไม่มีอาการแสดงแต่ยังเป็นพาหะนำโรค?", options: ["ก. ระยะติดเชื้อเฉียบพลัน", "ข. ระยะไม่มีอาการ", "ค. ระยะมีอาการ", "ง. ระยะเอดส์"], correct: 1, reason: "ในระยะนี้ผู้ป่วยส่วนใหญ่อาจไม่มีอาการแต่เป็นพาหะ" },
            { id: 18, text: "โรคใดที่เด็กเล็กควรได้รับวัคซีนกระตุ้นเมื่ออายุ 4 ปี?", options: ["ก. โรคเอดส์", "ข. โรคไข้หวัดนก", "ค. โรคมือ เท้า ปาก", "ง. โรคไอกรน"], correct: 3, reason: "การป้องกันโรคไอกรนรวมถึงการฉีดวัคซีนกระตุ้นเมื่ออายุ 4 ปี" },
            { id: 19, text: "ข้อใดคือการปฏิบัติเพื่อสุขลักษณะที่ดีในการป้องกันโรคมือ เท้า ปาก?", options: ["ก. รับประทานอาหารเสริม", "ข. ตัดเล็บมือและเท้าให้สั้นเสมอ", "ค. เข้ากอดผู้ป่วยเพื่อปลอบใจ", "ง. ดื่มน้ำต้มสมุนไพร"], correct: 1, reason: "การรักษาความสะอาดโดยตัดเล็บให้สั้นช่วยลดการสะสมของเชื้อโรค" },
            { id: 20, text: "COVID-19 สามารถแพร่กระจายได้จากสาเหตุใด?", options: ["ก. การกินยา", "ข. การสวมหน้ากากอนามัย", "ค. การสัมผัสกับพื้นผิวที่มีเชื้อ", "ง. การอาบน้ำ"], correct: 2, reason: "การสัมผัสพื้นผิวที่มีเชื้อเป็นช่องทางติดต่อที่สำคัญ" },
            { id: 21, text: "การใช้ 'ยาต้านไวรัส HIV' มีวัตถุประสงค์หลักเพื่ออะไร?", options: ["ก. รักษาให้หายขาด", "ข. ลดปริมาณเชื้อและเพิ่มภูมิคุ้มกัน", "ค. ฆ่าเชื้อแบคทีเรีย", "ง. ป้องกันการเกิดโรค"], correct: 1, reason: "ยาต้านไวรัสช่วยลดปริมาณเชื้อในร่างกายและเสริมภูมิคุ้มกัน" },
            { id: 22, text: "น้ำเน่าเสียเป็นแหล่งสะสมของอะไร?", options: ["ก. เชื้อโรค", "ข. วิตามิน", "ค. แร่ธาตุ", "ง. แสงแดด"], correct: 0, reason: "น้ำเน่าเสียเป็นแหล่งสะสมของเชื้อโรคที่ทำให้เกิดโรคติดต่อทางอาหารและน้ำ" },
            { id: 23, text: "ข้อควรระวังในการรักษาโรคอหิวาตกโรคคือข้อใด?", options: ["ก. ไม่ควรนอนพัก", "ข. ถ้าอาเจียนไม่ควรดื่มน้ำ", "ค. งดพบแพทย์", "ง. กินอาหารเผ็ด"], correct: 1, reason: "หากมีอาการอาเจียน ไม่ควรดื่มน้ำเพราะอาจทำให้อาเจียนซ้ำ" },
            { id: 24, text: "โรคใดที่เกิดจากการติดเชื้อของระบบทางเดินหายใจ และทำให้เกิดอาการไอถี่ๆ เป็นชุด?", options: ["ก. โรคเอดส์", "ข. โรคอุจจาระร่วง", "ค. โรคไอกรน", "ง. โรคไข้หวัดนก"], correct: 2, reason: "โรคไอกรนเป็นโรคติดเชื้อทางเดินหายใจที่มีอาการไอถี่ๆ เป็นลักษณะเฉพาะ" },
            { id: 25, text: "ข้อใดคือความเสี่ยงหลักในการเกิดโรคมือ เท้า ปากในเด็กเล็ก?", options: ["ก. เล่นดินทราย", "ข. กินขนมหวาน", "ค. ใช้ช้อนส้อมร่วมกับเด็กอื่น", "ง. ออกกำลังกายมากเกินไป"], correct: 2, reason: "การใช้สิ่งของร่วมกันเป็นช่องทางหลักของการติดต่อเชื้อเข้าสู่ปาก" }
        ];

        // NEW: Array เพื่อเก็บคำถามที่ถูกสุ่มลำดับแล้วสำหรับแบบทดสอบ
        let shuffledQuizQuestions = []; 
        let quizUserAnswers = {};
        
        let shuffledGameQuestions = []; // NEW: State for game questions with shuffled options
        let currentGameIndex = 0;

        let isIdRandomized = false;
        let currentQuizIndex = -1; 

        const gameQuestions = [
            { id: 1, image: "https://www.mccormickhospital.com/web/public/storage/photos/shares/blog/68/5c652be5e229c.jpg", question: "ภาพอาการถ่ายเหลวรุนแรงและขาดน้ำนี้คือ โรคอะไร?", 
              options: ["โรคไอกรน", "โรคอหิวาตกโรค", "โรคมือ เท้า ปาก"], answer: 1, 
              prevention_q: "การป้องกันโรคนี้ที่สำคัญที่สุดคือ?", prevention_options: ["การฉีดวัคซีนครบทุกเข็ม", "กินอาหารปรุงสุกและดื่มน้ำสะอาด", "สวมหน้ากากอนามัยเสมอ"], prevention_answer: 1, 
              feedback: "ถูกต้อง! คือโรคอหิวาตกโรค การป้องกันที่ดีที่สุดคือการระวังเรื่องอาหารและน้ำเพื่อไม่ให้เชื้อเข้าสู่ร่างกาย" },
            
            { id: 2, image: "https://multimedia.anamai.moph.go.th/oawoocha/2018/05/Hand_Foot_Mouth.jpg", question: "ภาพอาการตุ่มแดงและแผลหลุมตื้นที่มือและเท้าคือ โรคอะไร?", 
              options: ["โรคไข้หวัดนก", "โรคไอกรน", "โรคมือ เท้า ปาก"], answer: 2, 
              prevention_q: "การป้องกันโรคนี้ที่สำคัญที่สุดคือ?", prevention_options: ["หมั่นล้างมือและไม่ใช้สิ่งของร่วมกับผู้อื่น", "การใช้เข็มฉีดยาที่สะอาด", "การรับประทานยาปฏิชีวนะ"], prevention_answer: 0, 
              feedback: "ถูกต้อง! คือโรคมือ เท้า ปาก การป้องกันที่สำคัญที่สุดคือการล้างมือเพื่อป้องกันเชื้อไวรัสลำไส้" },

            { id: 3, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRqvIEbVAxohz14hr2EbbU2iernnBQ4R9auEA&s", question: "ภาพอาการไอถี่ๆ จนหายใจไม่ทัน และมีเสียงวูบ (Whooping) คือ โรคอะไร?", 
              options: ["โรคไอกรน", "โรคอหิวาตกโรค", "โรคเอดส์"], answer: 0, 
              prevention_q: "การป้องกันโรคนี้ที่สำคัญที่สุดคือ?", prevention_options: ["การกินอาหารที่มีวิตามินสูง", "การฉีดวัคซีนป้องกันตามกำหนด", "การพักผ่อนอย่างเต็มที่"], prevention_answer: 1, 
              feedback: "ถูกต้อง! คือโรคไอกรน ซึ่งป้องกันได้ดีที่สุดด้วยการฉีดวัคซีนตามแผนการให้วัคซีนในเด็ก" },
            { id: 4, image: "https://media.istockphoto.com/id/1137062701/th/เวคเตอร์/อินโฟกราฟิกอันตรายจากฝุ่น-pm-2-5-กับมนุษย์สวมหน้ากากกันฝุ่นด้วยฝุ่นและควัน.jpg?s=170667a&w=0&k=20&c=4VAvRT5Ubbpf7SfzezDZ26Zu8cK2DLL2dYwOB1pZ-zI=", question: "อาการแสบตา คันจมูก และหายใจลำบาก เกิดจากมลพิษทางอากาศประเภทใดเป็นหลัก?", 
              options: ["ควันจากรถยนต์", "ฝุ่น PM 2.5", "เสียงดังเกินไป"], answer: 1, 
              prevention_q: "วิธีป้องกันตัวเองจากมลพิษนี้ที่ดีที่สุดคือ?", prevention_options: ["ดื่มน้ำมาก ๆ", "สวมหน้ากาก N95 เมื่อมีฝุ่นสูง", "ใช้ยาฆ่าแมลง"], prevention_answer: 1, 
              feedback: "ถูกต้อง! ฝุ่น PM 2.5 เป็นอันตรายต่อระบบทางเดินหายใจ การใส่หน้ากาก N95 จึงสำคัญที่สุดเมื่อฝุ่นสูง" },

            { id: 5, image: "https://img.freepik.com/premium-vector/organic-garbage-with-leftover-food-fruit-peel-app_1138841-16596.jpg", question: "การปวดท้องรุนแรงและท้องเสียติดต่อกันเกิดจากอะไร?", 
              options: ["การกินอาหารรสจัด", "การออกกำลังกายหนัก", "การได้รับเชื้อจากอาหารหรือน้ำที่ไม่สะอาด"], answer: 2, 
              prevention_q: "การป้องกันการติดเชื้อในอาหารคือ?", prevention_options: ["ใช้ช้อนกลางในการกินอาหาร", "อาบน้ำวันละ 3 ครั้ง", "นอนพักผ่อน"], prevention_answer: 0, 
              feedback: "ถูกต้อง! การติดเชื้อในทางเดินอาหารเกิดจากเชื้อโรคที่มากับอาหารที่ไม่สะอาด การใช้ช้อนกลางช่วยป้องกันการแพร่เชื้อ" },

            { id: 6, image: "https://media.istockphoto.com/id/1469232664/th/เวคเตอร์/หูฟังที่มีเพลงเล่นเสียงดัง.jpg?s=612x612&w=0&k=20&c=FDDljv5wtd4sTgFMI_vznS70dNPqBajmxQJqqOEITX4=", question: "การได้ยินเสียงดังเกิน 85 เดซิเบลเป็นเวลานานส่งผลต่อสุขภาพด้านใด?", 
              options: ["การได้ยิน", "การมองเห็น", "การทำงานของไต"], answer: 0, 
              prevention_q: "วิธีลดผลกระทบจากมลพิษทางเสียงคือ?", prevention_options: ["ปลูกต้นไม้รอบบ้าน", "เปิดหน้าต่างรับลม", "ใช้ที่อุดหูในบริเวณที่มีเสียงดัง"], prevention_answer: 2,
              feedback: "ถูกต้อง! เสียงดังเป็นอันตรายต่อแก้วหูและการได้ยิน การใช้ที่อุดหูจึงจำเป็นในพื้นที่ที่มีเสียงดังมาก" },

            { id: 7, image: "https://img.freepik.com/premium-vector/flat-design-fabric-bag-collection_23-2149021315.jpg", question: "การพกถุงผ้าไปซูเปอร์มาร์เก็ตจัดเป็นหลักการจัดการขยะข้อใด?", 
              options: ["Reuse", "Recycle", "Reduce"], answer: 2, 
              prevention_q: "ประโยชน์หลักของการทำตามหลัก 3R คือ?", prevention_options: ["ลดปริมาณขยะ", "สร้างรายได้ให้ตัวเอง", "ทำให้รถติดน้อยลง"], prevention_answer: 0, 
              feedback: "ถูกต้อง! การใช้ถุงผ้าเป็นการลดปริมาณขยะ (Reduce) ที่ต้องใช้ครั้งเดียวทิ้ง และประโยชน์หลักของ 3R คือการลดปริมาณขยะ" },

            { id: 8, image: "https://cdn5.vectorstock.com/i/1000x1000/61/09/hiv-awareness-ribbon-vector-35026109.jpg", question: "การกระทำใด *ไม่สามารถ* ทำให้ติดเชื้อ HIV ได้?", 
              options: ["การจูบปากกับผู้ป่วย", "การใช้เข็มฉีดยาร่วมกัน", "การมีเพศสัมพันธ์โดยไม่ป้องกัน"], answer: 0, 
              prevention_q: "การป้องกันตัวเองจาก HIV ต้องทำอย่างไร?", prevention_options: ["กินอาหารที่มีไฟเบอร์", "หลีกเลี่ยงพฤติกรรมเสี่ยงและใช้ถุงยางอนามัย", "การกินยาปฏิชีวนะ"], prevention_answer: 1, 
              feedback: "ถูกต้อง! HIV ไม่ติดต่อจากการจูบปาก การป้องกันที่ดีที่สุดคือการหลีกเลี่ยงพฤติกรรมเสี่ยง" },

            { id: 9, image: "https://img.freepik.com/premium-vector/hand-washing-cartoon-vector-illustration_1021317-160.jpg", question: "การล้างมือบ่อย ๆ ช่วยป้องกันโรคใดไม่ได้เลย?", 
              options: ["โรคมะเร็งปอด", "ไข้หวัดใหญ่", "โรคมือ เท้า ปาก"], answer: 0, 
              prevention_q: "ควรล้างมือกี่ขั้นตอนเพื่อฆ่าเชื้อโรคได้อย่างมีประสิทธิภาพ?", prevention_options: ["2 ขั้นตอน", "7 ขั้นตอน", "10 ขั้นตอน"], prevention_answer: 1, 
              feedback: "ถูกต้อง! การล้างมือช่วยป้องกันโรคที่ติดต่อผ่านมือได้ดี แต่ไม่ได้ป้องกันมะเร็งปอด และควรล้าง 7 ขั้นตอน" },

            { id: 10, image: "https://img.freepik.com/premium-vector/polluted-water-with-household-waste-plastic-trash-environmental-pollution-concept_1313002-10760.jpg?w=360", question: "การมีขยะ/น้ำขังในบ้านเป็นแหล่งเพาะพันธุ์ของสิ่งใดที่นำมาซึ่งโรคไข้เลือดออก?", 
              options: ["แมลงวัน", "ยุงลาย", "หนู"], answer: 1, 
              prevention_q: "การป้องกันการเกิดโรคไข้เลือดออกที่ดีที่สุดในบ้านคือ?", prevention_options: ["เปิดไฟสว่าง", "เก็บกวาดภาชนะที่มีน้ำขัง", "พ่นสเปรย์ฆ่าแมลงทุกวัน"], prevention_answer: 1, 
              feedback: "ถูกต้อง! ยุงลายเป็นพาหะของโรคไข้เลือดออก การกำจัดแหล่งน้ำขังจึงสำคัญที่สุด" }
        ];

        // --- General Utility Function ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        /**
         * Shuffles the options array within a question object and updates the answer index accordingly.
         * @param {Object} question The game question object.
         * @param {string} optionsKey Key for the options array (e.g., 'options', 'prevention_options').
         * @param {string} answerKey Key for the correct answer index (e.g., 'answer', 'prevention_answer').
         * @returns {Object} The question object with shuffled options and updated answer index.
         */
        function shuffleOptionsAndIndex(question, optionsKey, answerKey) {
            const options = question[optionsKey];
            const originalCorrectIndex = question[answerKey];
            
            // 1. Create an array of objects to maintain the correct answer link
            const indexedOptions = options.map((text, index) => ({ text, index }));
            
            // 2. Perform the shuffle
            shuffleArray(indexedOptions);
            
            // 3. Find the new index of the original correct option (based on its 'index' property)
            const newCorrectIndex = indexedOptions.findIndex(item => item.index === originalCorrectIndex);
            
            // 4. Update the question object
            question[optionsKey] = indexedOptions.map(item => item.text); // Replace options with shuffled text
            question[answerKey] = newCorrectIndex; // Update the correct index
            
            return question;
        }


        // --- Page Navigation Functions ---

        document.addEventListener('DOMContentLoaded', () => {
            // Set initial active page (Page 1)
            changePage('page1');
            
            // Render content for Page 2 (Disease List)
            renderDiseaseList();

            // Render content for Page 4 (Game)
            setupGame();
            
            // Initial Quiz Setup
            updateQuizDisplayState();
        });

        function changePage(pageId) {
            // Hide all pages
            document.querySelectorAll('.content-page').forEach(page => {
                page.classList.remove('active');
                page.classList.add('hidden');
            });

            // Deactivate all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show the target page
            const targetPage = document.getElementById(pageId);
            const targetTab = document.querySelector(`.nav-tab[data-page="${pageId}"]`);

            if (targetPage && targetTab) {
                targetPage.classList.remove('hidden');
                // Use setTimeout to allow the display:block to apply before starting transition
                setTimeout(() => {
                    targetPage.classList.add('active');
                }, 10);
                targetTab.classList.add('active');
            }
        }

        // --- General Utility Function ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // --- Page 2: Disease List Renderer ---

        function renderDiseaseList() {
            const listContainer = document.getElementById('disease-list');
            listContainer.innerHTML = '';
            
            diseaseData.forEach((disease, index) => {
                const color = index % 2 === 0 ? 'bg-pink-50' : 'bg-teal-50';
                const textColor = index % 2 === 0 ? 'text-pink-700' : 'text-teal-700';

                const card = `
                    <div class="${color} p-4 rounded-xl border-l-4 border-current ${textColor} card-shadow flex flex-col sm:flex-row items-start space-y-2 sm:space-y-0 sm:space-x-4 text-sm">
                        <img src="${disease.image}" alt="ภาพ ${disease.name}" class="w-16 h-16 rounded-full object-cover border-3 border-white flex-shrink-0">
                        <div class="flex-grow">
                            <h4 class="text-lg font-bold ${textColor} mb-1">${index + 1}. ${disease.name}</h4>
                            <p class="text-gray-700">${disease.info}</p>
                        </div>
                    </div>
                `;
                listContainer.innerHTML += card;
            });
        }


        // --- Page 4: Game Functions (Updated to use all 10 questions) ---

        function setupGame() {
            // Shuffle the game questions before starting
            shuffleArray(gameQuestions);
            currentGameIndex = 0;
            displayGameQuestion();
        }

        function displayGameQuestion() {
            if (currentGameIndex >= gameQuestions.length) {
                // Game Over
                document.getElementById('game-quiz').innerHTML = `
                    <p class="text-3xl font-extrabold text-pink-600">จบเกมแล้ว! เก่งมากค่ะ/ครับ</p>
                    <p class="text-lg text-gray-700 mt-4">คุณทำแบบทดสอบเกมครบทุกข้อแล้ว</p>
                `;
                document.getElementById('next-game-btn').textContent = 'เริ่มเกมใหม่';
                document.getElementById('next-game-btn').classList.remove('hidden');
                document.getElementById('next-game-btn').onclick = setupGame;
                return;
            }

            const gameData = gameQuestions[currentGameIndex];
            const gameImage = document.getElementById('game-image');
            const gameQuestion = document.getElementById('game-question');
            const gameOptions = document.getElementById('game-options');
            const gameFeedback = document.getElementById('game-feedback');
            const nextBtn = document.getElementById('next-game-btn');
            
            gameImage.src = gameData.image;
            gameQuestion.innerHTML = `**คำถาม 1/2 (ข้อที่ ${currentGameIndex + 1}):** ${gameData.question}`;
            gameFeedback.classList.add('hidden');
            nextBtn.classList.add('hidden');
            gameOptions.innerHTML = '';

            gameData.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = `bg-pastel-pink hover:bg-pink-300 text-pink-800 font-semibold py-3 px-4 rounded-lg transition duration-200 shadow-sm text-sm sm:text-base w-full`;
                button.onclick = () => checkGameAnswer(gameData, index, 1);
                gameOptions.appendChild(button);
            });
        }

        function checkGameAnswer(gameData, selectedIndex, stage) {
            const gameOptions = document.getElementById('game-options');
            const gameFeedback = document.getElementById('game-feedback');
            const nextBtn = document.getElementById('next-game-btn');
            const isCorrect = stage === 1 ? selectedIndex === gameData.answer : selectedIndex === gameData.prevention_answer;

            // Disable all buttons
            Array.from(gameOptions.children).forEach((btn, index) => {
                btn.disabled = true;
                btn.classList.remove('bg-pastel-pink', 'bg-pastel-mint', 'hover:bg-pink-300', 'hover:bg-teal-300');
                btn.classList.add('cursor-not-allowed', 'opacity-75');

                if (stage === 1) {
                    // Stage 1: Disease Name Check
                    if (index === gameData.answer) {
                        btn.classList.add('bg-green-500', 'text-white');
                    } else if (index === selectedIndex) {
                        btn.classList.add('bg-red-500', 'text-white');
                    }
                } else {
                    // Stage 2: Prevention Check
                    if (index === gameData.prevention_answer) {
                        btn.classList.add('bg-green-500', 'text-white');
                    } else if (index === selectedIndex) {
                        btn.classList.add('bg-red-500', 'text-white');
                    }
                }
            });

            if (isCorrect) {
                gameFeedback.textContent = `✅ คำตอบถูกต้อง! ${stage === 1 ? 'ไปคำถามป้องกันต่อ...' : 'เยี่ยมมาก!'}`;
                gameFeedback.className = 'mt-6 p-4 rounded-lg font-medium bg-green-100 text-green-700';
            } else {
                gameFeedback.textContent = `❌ คำตอบผิด! ลองอีกครั้ง`;
                gameFeedback.className = 'mt-6 p-4 rounded-lg font-medium bg-red-100 text-red-700';
            }
            gameFeedback.classList.remove('hidden');

            if (stage === 1 && isCorrect) {
                // Move to Stage 2: Prevention Question
                setTimeout(() => displayPreventionQuestion(gameData), 1500);
            } else if (stage === 2 || !isCorrect) {
                // Show next button for next question or to retry
                nextBtn.classList.remove('hidden');
                nextBtn.textContent = 'คำถามถัดไป';
            }
        }

        function displayPreventionQuestion(gameData) {
            const gameQuestion = document.getElementById('game-question');
            const gameOptions = document.getElementById('game-options');
            const gameFeedback = document.getElementById('game-feedback');
            
            gameQuestion.innerHTML = `**คำถาม 2/2 (ข้อที่ ${currentGameIndex + 1}):** ${gameData.prevention_q}`;
            gameOptions.innerHTML = '';
            gameFeedback.classList.add('hidden');

            gameData.prevention_options.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = `bg-pastel-mint hover:bg-teal-300 text-teal-800 font-semibold py-3 px-4 rounded-lg transition duration-200 shadow-sm text-sm sm:text-base w-full`;
                button.onclick = () => checkGameAnswer(gameData, index, 2);
                gameOptions.appendChild(button);
            });
        }

        function nextGameQuestion() {
            currentGameIndex = (currentGameIndex + 1);
            displayGameQuestion();
        }


        // --- Page 5: Quiz Functions (Updated for Random Non-Repeating Questions) ---

        function updateQuizDisplayState() {
            const displayDiv = document.getElementById('quiz-question-display');
            const instruction = document.getElementById('quiz-instruction');
            const completionMsg = document.getElementById('quiz-completion-message');

            // ใช้ shuffledQuizQuestions.length ในการเช็คว่าครบทุกข้อแล้วหรือยัง
            if (currentQuizIndex >= shuffledQuizQuestions.length && isIdRandomized) {
                displayDiv.classList.add('hidden');
                instruction.classList.add('hidden');
                completionMsg.classList.remove('hidden');
            } else if (isIdRandomized) {
                displayDiv.classList.remove('hidden');
                instruction.classList.add('hidden');
                completionMsg.classList.add('hidden');
                displayCurrentQuizQuestion();
            } else {
                displayDiv.classList.add('hidden');
                instruction.classList.remove('hidden');
                completionMsg.classList.add('hidden');
            }
        }

        function randomizeId() {
            const minId = parseInt(document.getElementById('min-id').value);
            const maxId = parseInt(document.getElementById('max-id').value);
            const display = document.getElementById('student-id-display');

            if (isNaN(minId) || isNaN(maxId) || minId > maxId || minId < 1) {
                display.textContent = 'ระบุช่วงเลขที่ให้ถูกต้อง';
                display.classList.add('text-red-600');
                isIdRandomized = false;
                return;
            }

            const randomId = Math.floor(Math.random() * (maxId - minId + 1)) + minId;
            display.textContent = `เลขที่: ${randomId}`;
            display.classList.remove('text-red-600');
            display.classList.add('text-teal-700');

            // --- NEW LOGIC: Shuffle and Start Quiz ---
            isIdRandomized = true;
            
            // 1. คัดลอกและสุ่มลำดับคำถามทั้งหมด 25 ข้อ
            shuffledQuizQuestions = [...quizQuestions]; // Make a shallow copy
            shuffleArray(shuffledQuizQuestions);       // Shuffle the questions in place

            // 2. เริ่มต้นทำแบบทดสอบจากคำถามแรกของชุดที่สุ่มแล้ว
            currentQuizIndex = 0;
            quizUserAnswers = {}; // Clear previous answers
            updateQuizDisplayState();
        }

        function displayCurrentQuizQuestion() {
            // ใช้ shuffledQuizQuestions แทน quizQuestions เพื่อให้ได้คำถามตามลำดับที่สุ่ม
            if (currentQuizIndex < 0 || currentQuizIndex >= shuffledQuizQuestions.length) return;

            const q = shuffledQuizQuestions[currentQuizIndex];
            const qNumberEl = document.getElementById('quiz-q-number');
            const qTextEl = document.getElementById('quiz-q-text');
            const optionsDiv = document.getElementById('current-quiz-options');
            const feedbackDiv = document.getElementById('current-quiz-feedback');
            const nextBtn = document.getElementById('next-quiz-btn');
            const qCard = document.getElementById('current-question-card');

            // Reset UI
            qCard.classList.remove('border-green-300', 'border-red-300', 'ring-1');
            qCard.classList.add('border-gray-100');
            feedbackDiv.classList.add('hidden');
            nextBtn.classList.add('hidden');
            nextBtn.disabled = true;

            // Set content: ใช้ shuffledQuizQuestions.length สำหรับจำนวนรวม
            qNumberEl.textContent = `คำถามข้อที่ ${currentQuizIndex + 1}/${shuffledQuizQuestions.length}`;
            qTextEl.textContent = q.text;
            optionsDiv.innerHTML = '';

            // Render Options
            q.options.forEach((option, oIndex) => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = `quiz-option w-full text-left p-3 rounded-lg bg-gray-50 hover:bg-pastel-blue text-gray-700 transition duration-150 text-sm sm:text-base font-medium`;
                button.onclick = () => checkQuizAnswer(currentQuizIndex, oIndex);
                optionsDiv.appendChild(button);
            });
        }

        function checkQuizAnswer(qIndex, oIndex) {
            // qIndex ที่ส่งมาในฟังก์ชันนี้คือ currentQuizIndex
            if (quizUserAnswers[qIndex] !== undefined) return; 

            // ใช้ shuffledQuizQuestions
            const q = shuffledQuizQuestions[qIndex];
            const isCorrect = oIndex === q.correct;
            const optionsDiv = document.getElementById('current-quiz-options');
            const feedbackDiv = document.getElementById('current-quiz-feedback');
            const nextBtn = document.getElementById('next-quiz-btn');
            const qCard = document.getElementById('current-question-card');
            
            quizUserAnswers[qIndex] = oIndex;
            
            // Disable all options and show feedback
            Array.from(optionsDiv.children).forEach((btn, index) => {
                btn.disabled = true;
                btn.classList.remove('hover:bg-pastel-blue', 'bg-gray-50');
                btn.classList.add('cursor-not-allowed', 'opacity-80');

                if (index === q.correct) {
                    btn.classList.add('bg-green-500', 'text-white', 'font-semibold');
                } else if (index === oIndex) {
                    btn.classList.add('bg-red-500', 'text-white');
                }
            });

            // Show detailed feedback
            feedbackDiv.classList.remove('hidden');
            if (isCorrect) {
                feedbackDiv.className = 'mt-3 p-3 text-sm rounded-lg bg-green-100 text-green-700 font-medium';
                feedbackDiv.innerHTML = `✅ **คำตอบถูกต้อง!** <span class="text-xs">(${q.reason})</span>`;
                qCard.classList.remove('border-gray-100');
                qCard.classList.add('border-green-300', 'ring-1', 'ring-green-300');
            } else {
                feedbackDiv.className = 'mt-3 p-3 text-sm rounded-lg bg-red-100 text-red-700 font-medium';
                feedbackDiv.innerHTML = `❌ **คำตอบผิด!** คำตอบที่ถูกต้องคือ ${q.options[q.correct]}. <span class="text-xs">(${q.reason})</span>`;
                qCard.classList.remove('border-gray-100');
                qCard.classList.add('border-red-300', 'ring-1', 'ring-red-300');
            }
            
            // Show Next Button
            nextBtn.classList.remove('hidden');
            nextBtn.disabled = false;
            nextBtn.textContent = (qIndex + 1) === shuffledQuizQuestions.length ? 'สิ้นสุดแบบทดสอบ' : 'คำถามถัดไป';
        }
        
        function nextQuizQuestion() {
            currentQuizIndex++;
            updateQuizDisplayState();
        }
    </script>
</body>
</html>
